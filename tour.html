<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <title>wishbone</title>
    <meta name="description" content="TODO">
    <meta name="keywords" content="TODO">
    <meta author="">
    <link rel="stylesheet" href="asset/css/style.css" media="screen">
    <link rel="stylesheet" href="asset/css/timeline.css" media="screen">
    <link rel="preconnect" href="https://fonts.googleapis.com">
</head>

<body>
    <header>
        <h1>wishbone</h1>
        <h2>I vicini ci odiano dal 2007</h2>
    </header>
    <nav id="breadcrumb">
        <p>Ti trovi in <span lang="Home">Tour</span></p>
    </nav>
    <nav id="menu">
        <ul>
            <li><a href="index.html" lang="en">Home</a></li>
            <li><a href="aboutus.html" lang="en">About Us</a></li>
            <li><a href="journal.html" lang="en">Journal</a></li>
            <li id="currentLink" lang="en">Tour</li>
            <li><a href="music.html" lang="en">Music</a></li>
            <li><a href="shop.html" lang="en">Shop</a></li>
        </ul>
    </nav>
    <main>
        <h3>EUROPEAN TOUR</h3>
        <dl id="EuropeanTour">
            <dt>Italia</dt>
            <dd onclick="toggleDetails(this)">
                <p>
                    <strong>Roma</strong> - Colosseo
                    <time datetime="2024-06-12">12 Giugno 2024</time>
                </p>
                <div class="extra-details" hidden>
                    <button class="close-details" onclick="closeDetails(event, this)">Chiudi</button>
                    <p>Concerto unico a Roma presso il <a href="https://www.google.com/maps?q=Colosseo"
                            target="_blank">Colosseo</a>!</p>
                    <button aria-label="Compra Biglietto per Roma" onclick="handleTicketPurchase(event, 'Roma')">Compra Biglietto</button>
                    <a href="shop.html?tour=European%20Tour">
                        <button aria-label="Compra Merch per Roma - European Tour">Merch European Tour</button>
                    </a>
                </div>
            </dd>
            <dd onclick="toggleDetails(this)">
                <p>
                    <strong>Milano</strong> - Duomo
                    <time datetime="2024-06-15">15 Giugno 2024</time>
                </p>
                
                <div class="extra-details" hidden>
                    <button class="close-details" onclick="closeDetails(event, this)">Chiudi</button>

                    <p>Grande serata al <a href="https://www.google.com/maps?q=Duomo" target="_blank">Duomo</a> di Milano.</p>
                    <button aria-label="Compra Biglietto per Milano" onclick="handleTicketPurchase(event, 'Milano')">Compra Biglietto</button>
                    <a href="shop.html?tour=European%20Tour">
                        <button aria-label="Compra Merch per Milano - European Tour">Merch European Tour</button>
                    </a>
                </div>
            </dd>

            <dt>Spagna</dt>
            <dd onclick="toggleDetails(this)">
                <p>
                    <strong>Valencia</strong> - Mestalla
                    <time datetime="2024-07-10">10 Luglio 2024</time><br>
                </p>
                <div class="extra-details" hidden>
                    <button class="close-details" onclick="closeDetails(event, this)">Chiudi</button>

                    <p>Concerto emozionante allo <a href="https://www.google.com/maps?q=Stadio_Mestalla"
                            target="_blank">Stadio Mestalla</a> di Valencia.</p>
                    <button aria-label="Compra Biglietto per Valencia" onclick="handleTicketPurchase(event, 'Valencia')">Compra Biglietto</button>
                    <a href="shop.html?tour=European%20Tour">
                        <button aria-label="Compra Merch per Valencia - European Tour">Merch European Tour</button>
                    </a>
                </div>
            </dd>
            <dd onclick="toggleDetails(this)">
                <p>
                    <strong>Barcellona</strong> - Camp Nou
                    <time datetime="2024-07-12">12 Luglio 2024</time>
                </p>
                <div class="extra-details" hidden>
                    <button class="close-details" onclick="closeDetails(event, this)">Chiudi</button>

                    <p>Non perdere l'evento al <a href="https://www.google.com/maps?q=Camp Nou" target="_blank">Camp Nou</a> di Barcellona.</p>
                    <button aria-label="Compra Biglietto per Barcellona" onclick="handleTicketPurchase(event, 'Barcellona')">Compra Biglietto</button>
                    <a href="shop.html?tour=European%20Tour">
                        <button aria-label="Compra Merch per Barcellona - European Tour">Merch European Tour</button>
                    </a>
                </div>
            </dd>
        </dl>


        <h3>ASIAN TOUR</h3>
        <!-- Asia Tour -->
        <dl id="AsiaTour">
            <dt>Giappone</dt>
            <dd onclick="toggleDetails(this)">
                <p>
                    <strong>Tokyo</strong> - Tokyo Dome
                    <time datetime="2024-08-01">1 Agosto 2024</time>
                </p>
                <div class="extra-details" hidden>
                    <button class="close-details" onclick="closeDetails(event, this)">Chiudi</button>

                    <p>Spettacolare concerto al <a href="https://www.google.com/maps?q=Tokyo Dome" target="_blank">Tokyo Dome</a> di Tokyo.</p>
                    <button aria-label="Compra Biglietto per Tokyo" onclick="handleTicketPurchase(event, 'Tokyo')">Compra Biglietto</button>
                    <button aria-label="Compra Merch per Tokyo - Asia Tour">Merch Asia Tour</button>
                </div>
            </dd>
            <dt>Corea del Sud</dt>
            <dd onclick="toggleDetails(this)">
                <p>
                    <strong>Seoul</strong> - Olympic Stadium
                    <time datetime="2024-08-04">4 Agosto 2024</time>
                </p>
                <div class="extra-details" hidden>
                    <button class="close-details" onclick="closeDetails(event, this)">Chiudi</button>

                    <p>Grande evento allo <a href="https://www.google.com/maps?q=Olympic Stadium Seoul" target="_blank">Olympic Stadium</a> di Seoul.</p>
                    <button aria-label="Compra Biglietto per Seoul" onclick="handleTicketPurchase(event, 'Seul')">Compra Biglietto</button>
                    <a href="shop.html?tour=Asian%20Tour">
                        <button aria-label="Compra Merch per Seoul - Asia Tour">Merch Asia Tour</button>
                    </a>
                </div>
            </dd>
        </dl>

        <h3>AMERICAN TOUR</h3>
        <!-- America Tour -->
        <dl id="AmericaTour">
            <dt>Stati Uniti</dt>
            <dd onclick="toggleDetails(this)">
                <p>
                    <strong>New York</strong> - Madison Square Garden
                    <time datetime="2024-09-10">10 Settembre 2024</time>
                </p>
                <div class="extra-details" hidden>
                    <button class="close-details" onclick="closeDetails(event, this)">Chiudi</button>

                    <p>Evento iconico al <a href="https://www.google.com/maps?q=Madison Square Garden" target="_blank">Madison Square Garden</a> di New York.</p>
                    <button aria-label="Compra Biglietto per New York" onclick="handleTicketPurchase(event, 'New York')">Compra Biglietto</button>
                    <a href="shop.html?tour=American%20Tour">
                        <button aria-label="Compra Merch per New York - America Tour">Merch America Tour</button>
                    </a>
                </div>
            </dd>
            <dd onclick="toggleDetails(this)">
                <p>
                    <strong>Los Angeles</strong> - Staples Center
                    <time datetime="2024-09-12">12 Settembre 2024</time>
                </p>
                <div class="extra-details" hidden>
                    <button class="close-details" onclick="closeDetails(event, this)">Chiudi</button>

                    <p>Non perdere il concerto al <a href="https://www.google.com/maps?q=Staples Center"
                            target="_blank">Staples Center</a> di Los Angeles.</p>
                    <button aria-label="Compra Biglietto per Los Angeles" onclick="handleTicketPurchase(event, 'Los Angeles')">Compra Biglietto</button>
                    <a href="shop.html?tour=American%20Tour">
                        <button aria-label="Compra Merch per Los Angeles - America Tour">Merch America Tour</button>
                    </a>
                </div>
            </dd>
            <!-- Aggiungi altre città in America... -->
        </dl>
    </main>
    <footer>
        <img class="imgValidCode" src="asset/img/valid-xhtml10.png" alt="HTML valido">
        <p>Ombretta Gaggi, Cactus &amp; Federazione Italiana Pallavolo - <span lang="en">All rights Reserved</span></p>
    </footer>
    <script>
        async function checkLoginStatus() {
            // Verifica lo stato di login tramite una chiamata al server
            const response = await fetch("php/check_login.php", { method: "GET" });
            if (response.ok) {
                const data = await response.json();
                return data.logged_in; // Ritorna true o false in base alla risposta del server
            } else {
                console.error("Errore durante il controllo dello stato di login.");
                return false;
            }
        }

        async function handleTicketPurchase(event, city) {
            event.stopPropagation(); // Evita che il clic chiami `toggleDetails`
            const isLoggedIn = await checkLoginStatus();

            if (isLoggedIn) {
                // Utente loggato: vai direttamente alla pagina di acquisto
                window.location.href = `ticket.html?city=${encodeURIComponent(city)}`;
            } else {
                // Utente non loggato: reindirizza alla pagina di login con redirect alla pagina di acquisto
                const redirectUrl = encodeURIComponent(`ticket.html?city=${city}`);
                window.location.href = `login.html?redirect=${redirectUrl}`;
            }
        }

        function toggleDetails(element) {
            // Chiude tutti i dettagli aperti in altri tour
            document.querySelectorAll(".extra-details").forEach(details => {
                details.hidden = true;
            });

            // Mostra solo i dettagli dell'elemento cliccato
            const details = element.querySelector(".extra-details");
            if (details) {
                details.hidden = !details.hidden;
            }
        }

        function closeDetails(event, button) {
            // Evita la propagazione dell'evento al <dd>
            event.stopPropagation();

            // Chiude il div "extra-details" più vicino
            const details = button.closest(".extra-details");
            if (details) {
                details.hidden = true;
            }
        }


    </script>

</body>

</html>