<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta author="linkins">
    <meta name="description" content="TODO">
    <meta name="keywords" content="TODO">
    <meta name="viewport" content="width=device-width">

    <title>Biglietto Evento</title>

    <link rel="icon" href="asset/img/favicon.ico" type="image/x-icon">

    <style>
        /* Base styles from Tailwind */
        *,
        ::after,
        ::before {
            box-sizing: border-box;
        }

        html {
            line-height: 1.5;
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
        }

        body {
            margin: 1rem;
            font-family: inherit;
            line-height: inherit;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        p,
        pre {
            margin: 0;
        }

        img {
            max-width: 50%;
            height: auto;
            border-style: none;
        }

        button {
            background-color: transparent;
            padding: 0;
            cursor: pointer;
        }

        input,
        button,
        select,
        textarea {
            font-family: inherit;
            font-size: 100%;
            line-height: inherit;
            margin: 0;
        }

        table {
            border-collapse: collapse;
        }

        p {
            margin: 0;
        }

        /* Layout Styles */
        .container {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
        }

        .event-details {
            padding: 1.5rem;
            background-color: #fff;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            position: relative;
        }

        .event-header {
            display: flex;
            align-items: center;
            padding-top: 1rem;
        }

        .event-info {
            margin-left: 1rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .order-info-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .order-info,
        .barcode-container {
            flex-grow: 1;
            background-color: #fff;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            padding: 1rem;
        }

        .order-info {
            min-width: 16rem;
        }

        .barcode-container {
            min-width: 10rem;
            text-align: center;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>

<body>
    <main>
        <div id="ticketContainer" style="max-width: 40rem; margin: 2rem auto;">
            <!-- Event Details Section -->
            <div class="event-details">
                <h1 style="font-size: 1.25rem; font-weight: bold;" id="event">Evento</h1>
                <div class="event-header">
                    <!-- Event Banner -->
                    <img src="https://content.rockaroma.id//storage/articles/slider-65c939d00d016d9bbed4f5ca01667ce2.jpg"
                        alt="Rockaroma Festival Banner" style="border-radius: 0.375rem; max-width: 30%;">
                    <!-- Event Information -->
                    <div class="event-info">
                        <p style="display: flex; align-items: center; font-weight: bold;">üéüÔ∏è Biglietto</p>
                        <p style="display: flex; align-items: center;" id="date">üìÖ Data</p>
                        <p style="display: flex; align-items: center;" id="time">‚è∞ Ora</p>
                        <p style="display: flex; align-items: center;">üìç Gambir Expo - Arena PRJ Kemayoran</p>
                    </div>
                </div>
                <!-- Logo -->
                <div style="position: absolute; top: 1rem; right: 1rem;">
                    <img src="asset/img/favicon.ico" alt="Logo" style="width: 6rem; height: auto;">
                </div>
            </div>

            <!-- Order Information Section -->
            <div class="order-info-title">
                <h3 style="font-size: 1.125rem; font-weight: 600;">Informazioni Utente</h3>
            </div>

            <!-- Ticket Section -->
            <div class="container">
                <!-- Order Information Container -->
                <div class="order-info">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <p style="font-weight: 600; font-size: 0.75rem; color: #6b7280;">Nome</p>
                            <p style="font-weight: 500;" id="userName">Nome Utente</p>
                        </div>
                        <div>
                            <p style="font-weight: 600; font-size: 0.75rem; color: #6b7280;">Email</p>
                            <p style="font-weight: 500;" id="userEmail">Email Utente</p>
                        </div>
                    </div>
                </div>

                <!-- Barcode Container -->
                <div class="barcode-container">
                    <p style="font-weight: bold; font-size: 1.25rem;">QR Code</p>
                    <div id="qrCode1" style="margin: 0.5rem auto;"></div>
                </div>
            </div>

            <button id="printButton"
                style="padding: 0.5rem 1rem; background-color: #4CAF50; color: white; border: none; border-radius: 0.25rem; cursor: pointer;">Scarica
                Biglietto</button>
        </div>
    </main>

    <script>
        // Funzione per caricare l'email dal server PHP (get_email.php)
        fetch('php/get_mail.php')
            .then(response => response.json())
            .then(data => {
                document.getElementById('userEmail').textContent = data.email;
                generateQRCode(); // Genera il QR code per il biglietto
            })
            .catch(error => {
                console.error('Errore nel caricamento dell\'email:', error);
                document.getElementById('userEmail').textContent = 'Email non disponibile';
                generateQRCode();
            });

        // Carica i parametri dall'URL
        const urlParams = new URLSearchParams(window.location.search);
        document.getElementById('event').textContent = urlParams.get('city') || 'Evento sconosciuto';
        document.getElementById('date').textContent = urlParams.get('date') || 'Data non disponibile';
        document.getElementById('time').textContent = urlParams.get('time') || 'Orario non disponibile';
        document.getElementById('userName').textContent = urlParams.get('userName') || 'Nome non disponibile';

        // Funzione per generare QR Code
        function generateQRCode() {
            const ticketData = {
                event: document.getElementById('event').textContent,
                date: document.getElementById('date').textContent,
                time: document.getElementById('time').textContent,
                userName: document.getElementById('userName').textContent,
                userEmail: document.getElementById('userEmail').textContent
            };
            const qrCodeContent = JSON.stringify(ticketData);

            new QRCode(document.getElementById('qrCode1'), {
                text: qrCodeContent,
                width: 200,
                height: 200,
                colorDark: "#000000",
                colorLight: "#ffffff"
            });
        }

        // Funzione per scaricare il biglietto
        document.getElementById('printButton').addEventListener('click', () => {
            const container = document.getElementById('ticketContainer');
            const options = {
                margin: 1,
                filename: 'biglietto-evento.pdf',
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            html2pdf().from(container).set(options).save();
        });
    </script>

</body>

</html>